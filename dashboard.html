<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Ù…ÙƒØªØ¨Ø© ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="bg-[#13344F] text-white shadow-md">
    <div class="container mx-auto flex items-center justify-between px-6 py-3">
      <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø³Ù…Ø§ÙŠØ§" class="h-10 filter invert brightness-0">
      <h1 class="text-xl font-bold text-center flex-1">
        Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø§Ø±Ø³
      </h1>
      <div class="w-10"></div>
    </div>
  </header>

  <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
  <section class="container mx-auto my-6 px-4">
    <div class="bg-white rounded-lg shadow p-4 flex flex-col sm:flex-row gap-6 justify-center">
      <div>
        <label for="year" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©</label>
        <select id="year" class="border rounded px-3 py-2 w-40 focus:ring-2 focus:ring-blue-500">
          <option>2023</option>
          <option>2024</option>
          <option>2025</option>
        </select>
      </div>
      <div>
        <label for="month" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
        <select id="month" class="border rounded px-3 py-2 w-40 focus:ring-2 focus:ring-blue-500">
          <option>ÙŠÙ†Ø§ÙŠØ±</option>
          <option>ÙØ¨Ø±Ø§ÙŠØ±</option>
          <option>Ù…Ø§Ø±Ø³</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <main class="container mx-auto px-4">
    <div id="cardsContainer" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ± -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ±</h2>
        <div id="gauge-asir"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-asir" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-asir" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-asir">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-asir">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-asir">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-asir">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø§Ø­Ø© -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø§Ø­Ø©</h2>
        <div id="gauge-baha"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-baha" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-baha" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-baha">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-baha">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-baha">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-baha">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ù†Ø¬Ø±Ø§Ù† -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ù†Ø¬Ø±Ø§Ù†</h2>
        <div id="gauge-najran"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-najran" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-najran" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-najran">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-najran">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-najran">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-najran">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ø¬ÙŠØ²Ø§Ù† -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ø¬ÙŠØ²Ø§Ù†</h2>
        <div id="gauge-jazan"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-jazan" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-jazan" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-jazan">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-jazan">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-jazan">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-jazan">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙ„ÙŠ -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h2>
        <div id="gauge-total"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-total" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-total" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-total">ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-total">ğŸŸ¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-total">ğŸŸ¡ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-total">ğŸ”´ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

    </div>
  </main>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª -->
  <script>
    function getColor(value) {
      if (value >= 70) return "#16A34A";
      if (value >= 40) return "#FACC15";
      return "#DC2626";
    }

    function initGauge(id, percentId, statusId, targetValue) {
      let currentValue = 0;
      const options = {
        chart: { type: 'radialBar', height: 250 },
        series: [0],
        plotOptions: {
          radialBar: {
            startAngle: -90,
            endAngle: 90,
            hollow: { margin: 0, size: '70%' },
            track: { background: '#e0e0e0', strokeWidth: '100%' },
            dataLabels: { show: false }
          }
        },
        fill: { colors: [getColor(0)] },
      };

      const chart = new ApexCharts(document.querySelector(id), options);
      chart.render();

      const interval = setInterval(() => {
        if (currentValue < targetValue) {
          currentValue++;
          chart.updateOptions({
            series: [currentValue],
            fill: { colors: [getColor(currentValue)] }
          });
          document.querySelector(percentId).textContent = currentValue + "%";
          const statusText = document.querySelector(statusId);

          if (currentValue >= 70) {
            statusText.textContent = "Ù…Ù…ØªØ§Ø²";
            statusText.className = "text-green-600 text-2xl font-bold";
          } else if (currentValue >= 40) {
            statusText.textContent = "Ù…ØªÙˆØ³Ø·";
            statusText.className = "text-yellow-600 text-2xl font-bold";
          } else {
            statusText.textContent = "Ø¶Ø¹ÙŠÙ";
            statusText.className = "text-red-600 text-2xl font-bold";
          }
        } else {
          clearInterval(interval);
        }
      }, 20);
    }

    // âœ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Apps Script
    async function loadDashboard() {
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycb.../exec?action=dashboard");
        const result = await response.json();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ±ÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
        result.regions.forEach(region => {
          const key = region.region.trim(); // Ù…Ø«Ù„Ø§Ù‹: Ø¹Ø³ÙŠØ±ØŒ Ø§Ù„Ø¨Ø§Ø­Ø©...

          if (key.includes("Ø¹Ø³ÙŠØ±")) {
            initGauge("#gauge-asir", "#percent-asir", "#status-asir", region.percent);
            document.getElementById("visits-asir").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${region.visits}`;
            document.getElementById("green-asir").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${region.green}`;
            document.getElementById("yellow-asir").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${region.yellow}`;
            document.getElementById("red-asir").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${region.red}`;
          }

          if (key.includes("Ø§Ù„Ø¨Ø§Ø­Ø©")) {
            initGauge("#gauge-baha", "#percent-baha", "#status-baha", region.percent);
            document.getElementById("visits-baha").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${region.visits}`;
            document.getElementById("green-baha").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${region.green}`;
            document.getElementById("yellow-baha").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${region.yellow}`;
            document.getElementById("red-baha").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${region.red}`;
          }

          if (key.includes("Ù†Ø¬Ø±Ø§Ù†")) {
            initGauge("#gauge-najran", "#percent-najran", "#status-najran", region.percent);
            document.getElementById("visits-najran").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${region.visits}`;
            document.getElementById("green-najran").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${region.green}`;
            document.getElementById("yellow-najran").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${region.yellow}`;
            document.getElementById("red-najran").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${region.red}`;
          }

          if (key.includes("Ø¬ÙŠØ²Ø§Ù†")) {
            initGauge("#gauge-jazan", "#percent-jazan", "#status-jazan", region.percent);
            document.getElementById("visits-jazan").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${region.visits}`;
            document.getElementById("green-jazan").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${region.green}`;
            document.getElementById("yellow-jazan").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${region.yellow}`;
            document.getElementById("red-jazan").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${region.red}`;
          }
        });

        // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„ÙŠ
        initGauge("#gauge-total", "#percent-total", "#status-total", result.total.percent);
        document.getElementById("visits-total").textContent = `ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${result.total.visits}`;
        document.getElementById("green-total").textContent = `ğŸŸ¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${result.total.green}`;
        document.getElementById("yellow-total").textContent = `ğŸŸ¡ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${result.total.yellow}`;
        document.getElementById("red-total").textContent = `ğŸ”´ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${result.total.red}`;

      } catch (err) {
        console.error("âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", loadDashboard);
  </script>

</body>
</html>
