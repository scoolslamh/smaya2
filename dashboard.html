<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø§Ø±Ø³</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Ù…ÙƒØªØ¨Ø© ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="bg-[#13344F] text-white shadow-md">
    <div class="container mx-auto flex items-center justify-between px-6 py-3">
      <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø³Ù…Ø§ÙŠØ§" class="h-10 filter invert brightness-0">
      <h1 class="text-xl font-bold text-center flex-1">
        Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø¯Ø§Ø±Ø³
      </h1>
      <div class="w-10"></div>
    </div>
  </header>

  <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
  <section class="container mx-auto my-6 px-4">
    <div class="bg-white rounded-lg shadow p-4 flex flex-col sm:flex-row gap-6 justify-center">
      <div>
        <label for="year" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©</label>
        <select id="year" class="border rounded px-3 py-2 w-40 focus:ring-2 focus:ring-blue-500">
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
      </div>
      <div>
        <label for="month" class="block text-sm font-medium text-gray-700 mb-1">Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</label>
        <select id="month" class="border rounded px-3 py-2 w-40 focus:ring-2 focus:ring-blue-500">
          <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
          <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
          <option value="3">Ù…Ø§Ø±Ø³</option>
          <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
          <option value="5">Ù…Ø§ÙŠÙˆ</option>
          <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
          <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
          <option value="8">Ø£ØºØ³Ø·Ø³</option>
          <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
          <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
          <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
          <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
  <main class="container mx-auto px-4">
    <div id="cardsContainer" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ± -->
      <div class="w-80 mx-auto bg-white rounded-lg shadow-md p-6 text-center">
  <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ±</h2>

  <!-- Ø§Ù„Ù…Ø¤Ø´Ø± Ù…Ø¹ Ø­Ø¬Ù… Ø«Ø§Ø¨Øª -->
  <div id="gauge-asir" class="w-56 h-56 mx-auto"></div>

  <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
  <div class="mt-6 text-right text-base font-semibold text-gray-700 space-y-2">
    <p id="visits-asir">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
    <p id="green-asir">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
    <p id="yellow-asir">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
    <p id="red-asir">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
  </div>
</div>




      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø§Ø­Ø© -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø§Ø­Ø©</h2>
        <div id="gauge-baha"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-baha" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-baha" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-baha">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-baha">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-baha">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-baha">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ù†Ø¬Ø±Ø§Ù† -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ù†Ø¬Ø±Ø§Ù†</h2>
        <div id="gauge-najran"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-najran" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-najran" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-najran">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-najran">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-najran">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-najran">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ù…Ù†Ø·Ù‚Ø© Ø¬ÙŠØ²Ø§Ù† -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Ù…Ù†Ø·Ù‚Ø© Ø¬ÙŠØ²Ø§Ù†</h2>
        <div id="gauge-jazan"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-jazan" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-jazan" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-jazan">ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-jazan">ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-jazan">ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-jazan">ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

      <!-- ÙƒØ±Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙ„ÙŠ -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h2>
        <div id="gauge-total"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-total" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-total" class="text-2xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-total">ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: -</p>
          <p id="green-total">ğŸŸ¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: -</p>
          <p id="yellow-total">ğŸŸ¡ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: -</p>
          <p id="red-total">ğŸ”´ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: -</p>
        </div>
      </div>

    </div>
  </main>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª -->
<script>
  function getColor(value) {
    if (value >= 70) return "#16A34A";   // Ø£Ø®Ø¶Ø±
    if (value >= 40) return "#FACC15";   // Ø£ØµÙØ±
    return "#DC2626";                    // Ø£Ø­Ù…Ø±
  }

  // âœ… Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¤Ø´Ø±
  function initGauge(id, targetValue) {
    const el = document.querySelector(id);
    if (!el) return; // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø¹Ù†ØµØ± Ù…ÙˆØ¬ÙˆØ¯

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…
    el.innerHTML = "";

    const options = {
      chart: { type: "radialBar", height: 280 },
      series: [targetValue],
      plotOptions: {
        radialBar: {
          startAngle: -90,
          endAngle: 90,
          hollow: { margin: 0, size: "70%" },
          track: { background: "#e0e0e0" },
          dataLabels: {
            name: { show: false },
            value: {
              show: true,
              fontSize: "28px",
              fontWeight: "bold",
              formatter: (val) => val + "%"
            }
          }
        }
      },
      fill: { colors: [getColor(targetValue)] }
    };

    const chart = new ApexCharts(el, options);
    chart.render();
  }

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API
  async function loadDashboard() {
    const year = document.getElementById("year").value;
    const month = document.getElementById("month").value;

    try {
      const res = await fetch(
        `https://script.google.com/macros/s/AKfycb.../exec?action=dashboard&year=${year}&month=${month}`
      );
      const data = await res.json();

      // Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ±
      initGauge("#gauge-asir", data.asir.percent);
      document.getElementById("visits-asir").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${data.asir.visits}`;
      document.getElementById("green-asir").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${data.asir.green}`;
      document.getElementById("yellow-asir").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${data.asir.yellow}`;
      document.getElementById("red-asir").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${data.asir.red}`;

      // Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø§Ø­Ø©
      initGauge("#gauge-baha", data.baha.percent);
      document.getElementById("visits-baha").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${data.baha.visits}`;
      document.getElementById("green-baha").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${data.baha.green}`;
      document.getElementById("yellow-baha").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${data.baha.yellow}`;
      document.getElementById("red-baha").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${data.baha.red}`;

      // Ù…Ù†Ø·Ù‚Ø© Ù†Ø¬Ø±Ø§Ù†
      initGauge("#gauge-najran", data.najran.percent);
      document.getElementById("visits-najran").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${data.najran.visits}`;
      document.getElementById("green-najran").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${data.najran.green}`;
      document.getElementById("yellow-najran").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${data.najran.yellow}`;
      document.getElementById("red-najran").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${data.najran.red}`;

      // Ù…Ù†Ø·Ù‚Ø© Ø¬ÙŠØ²Ø§Ù†
      initGauge("#gauge-jazan", data.jazan.percent);
      document.getElementById("visits-jazan").textContent = `ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${data.jazan.visits}`;
      document.getElementById("green-jazan").textContent = `ğŸŸ¢ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${data.jazan.green}`;
      document.getElementById("yellow-jazan").textContent = `ğŸŸ¡ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${data.jazan.yellow}`;
      document.getElementById("red-jazan").textContent = `ğŸ”´ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${data.jazan.red}`;

      // Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙƒÙ„ÙŠ
      initGauge("#gauge-total", data.total.percent);
      document.getElementById("visits-total").textContent = `ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${data.total.visits}`;
      document.getElementById("green-total").textContent = `ğŸŸ¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø®Ø¶Ø±: ${data.total.green}`;
      document.getElementById("yellow-total").textContent = `ğŸŸ¡ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£ØµÙØ±: ${data.total.yellow}`;
      document.getElementById("red-total").textContent = `ğŸ”´ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø£Ø­Ù…Ø±: ${data.total.red}`;
    } catch (err) {
      console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", err);
    }
  }

  // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  document.addEventListener("DOMContentLoaded", loadDashboard);
  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ±
  document.getElementById("year").addEventListener("change", loadDashboard);
  document.getElementById("month").addEventListener("change", loadDashboard);
</script>

</body>
</html>
