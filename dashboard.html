<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ููุญุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ ูุชูููู ุงููุฏุงุฑุณ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ููุชุจุฉ ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- ุงูููุฏุฑ -->
  <header class="bg-[#13344F] text-white shadow-md">
    <div class="container mx-auto flex items-center justify-between px-6 py-3">
      <img src="logo.png" alt="ุดุนุงุฑ ุณูุงูุง" class="h-10 filter invert brightness-0">
      <h1 class="text-xl font-bold text-center flex-1">
        ููุญุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ ูุชูููู ุงููุฏุงุฑุณ
      </h1>
      <div class="w-10"></div>
    </div>
  </header>

  <!-- ุงูููุงุชุฑ -->
  <section class="container mx-auto my-6 px-4">
    <div class="bg-white rounded-lg shadow p-4 flex flex-col sm:flex-row gap-6 justify-center">
      <div>
        <label for="year" class="block text-sm font-medium text-gray-700 mb-1">ุงุฎุชุฑ ุงูุณูุฉ</label>
        <select id="year" class="border rounded px-3 py-2 w-40 focus:ring-2 focus:ring-blue-500">
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          <option value="2025">2025</option>
        </select>
      </div>
      <div>
        <label for="month" class="block text-sm font-medium text-gray-700 mb-1">ุงุฎุชุฑ ุงูุดูุฑ</label>
        <select id="month" class="border rounded px-3 py-2 w-40 focus:ring-2 focus:ring-blue-500">
          <option value="1">ููุงูุฑ</option>
          <option value="2">ูุจุฑุงูุฑ</option>
          <option value="3">ูุงุฑุณ</option>
          <option value="4">ุฃุจุฑูู</option>
          <option value="5">ูุงูู</option>
          <option value="6">ููููู</option>
          <option value="7">ููููู</option>
          <option value="8">ุฃุบุณุทุณ</option>
          <option value="9">ุณุจุชูุจุฑ</option>
          <option value="10">ุฃูุชูุจุฑ</option>
          <option value="11">ููููุจุฑ</option>
          <option value="12">ุฏูุณูุจุฑ</option>
        </select>
      </div>
    </div>
  </section>

  <!-- ุงููุญุชูู -->
  <main class="container mx-auto px-4">
    <div id="cardsContainer" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">

      <!-- ูุฑุช ููุทูุฉ ุนุณูุฑ -->
      <div class="w-80 mx-auto bg-white rounded-lg shadow-md p-6 text-center">
  <h2 class="text-lg font-bold text-gray-800 mb-4">ููุทูุฉ ุนุณูุฑ</h2>

  <!-- ุงููุคุดุฑ ูุน ุญุฌู ุซุงุจุช -->
  <div id="gauge-asir" class="w-56 h-56 mx-auto"></div>

  <!-- ุชูุงุตูู ุงูุฃุฑูุงู -->
  <div class="mt-6 text-right text-base font-semibold text-gray-700 space-y-2">
    <p id="visits-asir">๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: -</p>
    <p id="green-asir">๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: -</p>
    <p id="yellow-asir">๐ก ุงููุทุงู ุงูุฃุตูุฑ: -</p>
    <p id="red-asir">๐ด ุงููุทุงู ุงูุฃุญูุฑ: -</p>
  </div>
</div>




      <!-- ูุฑุช ููุทูุฉ ุงูุจุงุญุฉ -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">ููุทูุฉ ุงูุจุงุญุฉ</h2>
        <div id="gauge-baha"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-baha" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-baha" class="text-2xl font-bold">ุฌุงุฑู ุงูุชุญุฏูุซ...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-baha">๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: -</p>
          <p id="green-baha">๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: -</p>
          <p id="yellow-baha">๐ก ุงููุทุงู ุงูุฃุตูุฑ: -</p>
          <p id="red-baha">๐ด ุงููุทุงู ุงูุฃุญูุฑ: -</p>
        </div>
      </div>

      <!-- ูุฑุช ููุทูุฉ ูุฌุฑุงู -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">ููุทูุฉ ูุฌุฑุงู</h2>
        <div id="gauge-najran"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-najran" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-najran" class="text-2xl font-bold">ุฌุงุฑู ุงูุชุญุฏูุซ...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-najran">๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: -</p>
          <p id="green-najran">๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: -</p>
          <p id="yellow-najran">๐ก ุงููุทุงู ุงูุฃุตูุฑ: -</p>
          <p id="red-najran">๐ด ุงููุทุงู ุงูุฃุญูุฑ: -</p>
        </div>
      </div>

      <!-- ูุฑุช ููุทูุฉ ุฌูุฒุงู -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">ููุทูุฉ ุฌูุฒุงู</h2>
        <div id="gauge-jazan"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-jazan" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-jazan" class="text-2xl font-bold">ุฌุงุฑู ุงูุชุญุฏูุซ...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-jazan">๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: -</p>
          <p id="green-jazan">๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: -</p>
          <p id="yellow-jazan">๐ก ุงููุทุงู ุงูุฃุตูุฑ: -</p>
          <p id="red-jazan">๐ด ุงููุทุงู ุงูุฃุญูุฑ: -</p>
        </div>
      </div>

      <!-- ูุฑุช ุงูุชูููู ุงูููู -->
      <div class="max-w-sm mx-auto bg-white rounded-lg shadow-md p-6 text-center relative">
        <h2 class="text-lg font-bold text-gray-800 mb-4">๐ ุงูุชูููู ุงูููู ูุฌููุน ุงูููุงุทู</h2>
        <div id="gauge-total"></div>
        <div class="absolute top-28 left-1/2 transform -translate-x-1/2 text-center">
          <p id="percent-total" class="text-4xl font-extrabold text-gray-900">0%</p>
          <p id="status-total" class="text-2xl font-bold">ุฌุงุฑู ุงูุชุญุฏูุซ...</p>
        </div>
        <div class="mt-12 text-right text-base font-semibold text-gray-700 space-y-2">
          <p id="visits-total">๐ ูุฌููุน ุงูุฒูุงุฑุงุช: -</p>
          <p id="green-total">๐ข ูุฌููุน ุงููุทุงู ุงูุฃุฎุถุฑ: -</p>
          <p id="yellow-total">๐ก ูุฌููุน ุงููุทุงู ุงูุฃุตูุฑ: -</p>
          <p id="red-total">๐ด ูุฌููุน ุงููุทุงู ุงูุฃุญูุฑ: -</p>
        </div>
      </div>

    </div>
  </main>

  <!-- ุณูุฑุจุช ุงููุคุดุฑุงุช -->
<script>
  function getColor(value) {
    if (value >= 70) return "#16A34A";   // ุฃุฎุถุฑ
    if (value >= 40) return "#FACC15";   // ุฃุตูุฑ
    return "#DC2626";                    // ุฃุญูุฑ
  }

  // โ ุฏุงูุฉ ุงููุคุดุฑ
  function initGauge(id, targetValue) {
    const el = document.querySelector(id);
    if (!el) return; // ุชุฃูุฏ ุฃู ุงูุนูุตุฑ ููุฌูุฏ

    // ุชูุธูู ุงููุคุดุฑ ุงููุฏูู
    el.innerHTML = "";

    const options = {
      chart: { type: "radialBar", height: 280 },
      series: [targetValue],
      plotOptions: {
        radialBar: {
          startAngle: -90,
          endAngle: 90,
          hollow: { margin: 0, size: "70%" },
          track: { background: "#e0e0e0" },
          dataLabels: {
            name: { show: false },
            value: {
              show: true,
              fontSize: "28px",
              fontWeight: "bold",
              formatter: (val) => val + "%"
            }
          }
        }
      },
      fill: { colors: [getColor(targetValue)] }
    };

    const chart = new ApexCharts(el, options);
    chart.render();
  }

  // โ ุชุญููู ุงูุจูุงูุงุช ูู API
  async function loadDashboard() {
    const year = document.getElementById("year").value;
    const month = document.getElementById("month").value;

    try {
      const res = await fetch(
        `https://script.google.com/macros/s/AKfycb.../exec?action=dashboard&year=${year}&month=${month}`
      );
      const data = await res.json();

      // ููุทูุฉ ุนุณูุฑ
      initGauge("#gauge-asir", data.asir.percent);
      document.getElementById("visits-asir").textContent = `๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: ${data.asir.visits}`;
      document.getElementById("green-asir").textContent = `๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: ${data.asir.green}`;
      document.getElementById("yellow-asir").textContent = `๐ก ุงููุทุงู ุงูุฃุตูุฑ: ${data.asir.yellow}`;
      document.getElementById("red-asir").textContent = `๐ด ุงููุทุงู ุงูุฃุญูุฑ: ${data.asir.red}`;

      // ููุทูุฉ ุงูุจุงุญุฉ
      initGauge("#gauge-baha", data.baha.percent);
      document.getElementById("visits-baha").textContent = `๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: ${data.baha.visits}`;
      document.getElementById("green-baha").textContent = `๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: ${data.baha.green}`;
      document.getElementById("yellow-baha").textContent = `๐ก ุงููุทุงู ุงูุฃุตูุฑ: ${data.baha.yellow}`;
      document.getElementById("red-baha").textContent = `๐ด ุงููุทุงู ุงูุฃุญูุฑ: ${data.baha.red}`;

      // ููุทูุฉ ูุฌุฑุงู
      initGauge("#gauge-najran", data.najran.percent);
      document.getElementById("visits-najran").textContent = `๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: ${data.najran.visits}`;
      document.getElementById("green-najran").textContent = `๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: ${data.najran.green}`;
      document.getElementById("yellow-najran").textContent = `๐ก ุงููุทุงู ุงูุฃุตูุฑ: ${data.najran.yellow}`;
      document.getElementById("red-najran").textContent = `๐ด ุงููุทุงู ุงูุฃุญูุฑ: ${data.najran.red}`;

      // ููุทูุฉ ุฌูุฒุงู
      initGauge("#gauge-jazan", data.jazan.percent);
      document.getElementById("visits-jazan").textContent = `๐ ุนุฏุฏ ุงูุฒูุงุฑุงุช: ${data.jazan.visits}`;
      document.getElementById("green-jazan").textContent = `๐ข ุงููุทุงู ุงูุฃุฎุถุฑ: ${data.jazan.green}`;
      document.getElementById("yellow-jazan").textContent = `๐ก ุงููุทุงู ุงูุฃุตูุฑ: ${data.jazan.yellow}`;
      document.getElementById("red-jazan").textContent = `๐ด ุงููุทุงู ุงูุฃุญูุฑ: ${data.jazan.red}`;

      // ุงูุชูููู ุงูููู
      initGauge("#gauge-total", data.total.percent);
      document.getElementById("visits-total").textContent = `๐ ูุฌููุน ุงูุฒูุงุฑุงุช: ${data.total.visits}`;
      document.getElementById("green-total").textContent = `๐ข ูุฌููุน ุงููุทุงู ุงูุฃุฎุถุฑ: ${data.total.green}`;
      document.getElementById("yellow-total").textContent = `๐ก ูุฌููุน ุงููุทุงู ุงูุฃุตูุฑ: ${data.total.yellow}`;
      document.getElementById("red-total").textContent = `๐ด ูุฌููุน ุงููุทุงู ุงูุฃุญูุฑ: ${data.total.red}`;
    } catch (err) {
      console.error("ุฎุทุฃ ูู ุฌูุจ ุงูุจูุงูุงุช:", err);
    }
  }

  // ุชุดุบูู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
  document.addEventListener("DOMContentLoaded", loadDashboard);
  // ุฅุนุงุฏุฉ ุงูุชุญุฏูุซ ุนูุฏ ุชุบููุฑ ุงูููุงุชุฑ
  document.getElementById("year").addEventListener("change", loadDashboard);
  document.getElementById("month").addEventListener("change", loadDashboard);
</script>

</body>
</html>
