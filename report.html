<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تقرير زيارة مبنى مدرسي</title>
  <!-- ربط ملف CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ✅ الهيدر -->
  <div class="header">
    <div class="title">
      <h1>شركة سمايا</h1>
      <p>تقرير زيارة مبنى مدرسي</p>
    </div>
    <img src="logo.png" alt="شعار سمايا" class="logo">
  </div>
</body>
</html>



    .report-container {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin: 20px auto;
      max-width: 1200px;
      display: none; /* ✅ نخفيه حتى يتم تحميل البيانات */
    }

    .report-container h2 {
      text-align: center;
      color: #13344f;
      margin-bottom: 10px;
    }

    .section-title {
      margin: 25px 0 10px;
      padding: 10px;
      background: #13344f;
      color: #fff;
      border-radius: 6px;
      font-size: 16px;
    }

    .report-table {
      width: 100%;
      border-collapse: collapse;
    }

    .report-table th, 
    .report-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: right;
      font-size: 14px;
    }

    .report-table th {
      background: #f0f4f8;
      color: #13344f;
      width: 15%;
    }

    .report-table td {
      width: 18%;
    }

    .print-btn {
      display: block;
      margin: 25px auto 0;
      padding: 10px 20px;
      background: #13344f;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .print-btn:hover {
      background: #0e2233;
    }

    /* ✅ شاشة التحميل */
    .loader {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #13344f;
      font-size: 18px;
    }
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #13344f;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <!-- ✅ شاشة التحميل -->
  <div class="loader" id="loader">
    <div class="spinner"></div>
    <div>جاري تحميل التقرير...</div>
  </div>

  <!-- ✅ محتوى التقرير -->
  <div class="report-container" id="reportContainer">
    <h2>📑 تقرير زيارة المدرسة</h2>

    <!-- ✅ البيانات الأساسية -->
    <div class="section-title">📌 البيانات الأساسية</div>
    <table class="report-table">
      <tr>
        <th>📅 التاريخ</th><td id="visit_date"></td>
        <th>📌 اليوم</th><td id="visit_day"></td>
        <th>📆 الشهر</th><td id="visit_month"></td>
      </tr>
      <tr>
        <th>📆 السنة</th><td id="visit_year"></td>
        <th>👤 المشرف الزائر</th><td id="visitor"></td>
        <th>🏫 المدرسة</th><td id="school"></td>
      </tr>
      <tr>
        <th>🏢 المنطقة</th><td id="region"></td>
        <th>🏙️ المدينة</th><td id="city"></td>
        <th>🔖 الرقم الوزاري</th><td id="code"></td>
      </tr>
      <tr>
        <th>📍 الحي / الشارع</th><td id="street"></td>
        <th>📊 تصنيف المدرسة</th><td id="category"></td>
        <th>🏷️ المرحلة التعليمية</th><td id="stage"></td>
      </tr>
      <tr>
        <th>➕ مراحل ملحقة</th><td id="extra_stages"></td>
        <th>📅 تاريخ الفحص</th><td id="inspection_date"></td>
        <th>🏫 عدد الفصول</th><td id="classes"></td>
      </tr>
    </table>

    <!-- ✅ الصحة والسلامة -->
    <div class="section-title">🚨 الصحة والسلامة</div>
    <table class="report-table">
      <tr>
        <th>🚪 مخارج الطوارئ</th><td id="emergency_exits"></td>
        <th>🔢 عددها</th><td id="emergency_exits_count"></td>
        <th>🧯 طفايات الحريق</th><td id="fire_extinguishers"></td>
      </tr>
      <tr>
        <th>🔢 عدد الطفايات</th><td id="fire_extinguishers_count"></td>
        <th>🧵 بكرات الحريق</th><td id="fire_hose_reels"></td>
        <th>🔢 عدد البكرات</th><td id="fire_hose_reels_count"></td>
      </tr>
      <tr>
        <th>📢 جرس الإنذار</th><td id="fire_alarm"></td>
        <th>🔢 عدد الأجراس</th><td id="fire_alarm_count"></td>
        <th>🚨 كواشف الدخان</th><td id="smoke_detectors"></td>
      </tr>
      <tr>
        <th>🔢 عدد الكواشف</th><td id="smoke_detectors_count"></td>
        <th>🚧 حواجز السلامة</th><td id="safety_barriers"></td>
        <th>🚪 لوحات المخارج</th><td id="exit_signs"></td>
      </tr>
      <tr>
        <th>⛑️ إسعافات أولية</th><td id="first_aid"></td>
        <th>📍 نقاط التجمع</th><td id="assembly_points"></td>
        <th>🔢 عددها</th><td id="assembly_points_count"></td>
      </tr>
      <tr>
        <th>📄 وثائق السلامة</th><td id="safety_docs"></td>
        <th>📡 وصلة الدفاع المدني</th><td id="civil_defense"></td>
        <th>🔑 الأبواب والمفاتيح</th><td id="keys"></td>
      </tr>
    </table>

    <!-- ✅ العناصر المدنية -->
    <div class="section-title">🏗️ العناصر المدنية</div>
    <table class="report-table">
      <tr>
        <th>🧱 الحوائط</th><td id="walls_condition"></td>
        <th>🪜 السلالم</th><td id="stairs"></td>
        <th>🪟 النوافذ</th><td id="windows"></td>
      </tr>
      <tr>
        <th>🚪 الأبواب</th><td id="doors"></td>
        <th>🪵 الأرضيات</th><td id="floors_condition"></td>
        <th>🌤️ المناور</th><td id="light_wells"></td>
      </tr>
      <tr>
        <th>🏠 عزل السطح</th><td id="roof_insulation"></td>
        <th>💧 تصريف السطح</th><td id="roof_drainage"></td>
        <th>🧱 إطار السطح</th><td id="roof_frame"></td>
      </tr>
      <tr>
        <th>♿ منحدر</th><td id="accessibility_ramp"></td>
        <th>🌳 الحالة الخارجية</th><td id="external_condition"></td>
        <th>🚪 البوابات</th><td id="main_gates"></td>
      </tr>
      <tr>
        <th>🧱 السور</th><td id="fence"></td>
        <th>⚙️ العناصر الميكانيكية</th><td id="mechanical"></td>
        <th>🔌 لوحة التوزيع</th><td id="distribution"></td>
      </tr>
      <tr>
        <th>⚡ التأريض</th><td id="earthing"></td>
        <th>🔊 الصوت</th><td id="sound"></td>
        <th>💡 الإضاءة</th><td id="lighting"></td>
      </tr>
      <tr>
        <th>🚨 إضاءة الطوارئ</th><td id="emergency_lighting"></td>
        <th>🔌 المقابس</th><td id="sockets"></td>
        <th>❄️ المكيفات</th><td id="ac"></td>
      </tr>
      <tr>
        <th>💧 المضخات</th><td id="pumps"></td>
        <th>🌬️ مراوح الشفط</th><td id="fans"></td>
        <th>🛗 المصاعد</th><td id="elevators"></td>
      </tr>
      <tr>
        <th>🔥 سخانات المياه</th><td id="heaters"></td>
        <th>🚰 خزان أرضي</th><td id="tank_ground"></td>
        <th>🚰 خزان علوي</th><td id="tank_top"></td>
      </tr>
      <tr>
        <th>🚧 الحواجز</th><td id="barriers"></td>
        <th>⚡ توصيلات عشوائية</th><td id="wiring"></td>
        <td colspan="2"></td>
      </tr>
    </table>

    <button onclick="window.print()" class="print-btn">🖨️ طباعة / حفظ PDF</button>
  </div>

  <script>
    const API_URL = "/.netlify/functions/api"; 

    const urlParams = new URLSearchParams(window.location.search);
    const schoolName = urlParams.get("school");
    const visitNumber = urlParams.get("visit");

    async function loadReport() {
      const loader = document.getElementById("loader");
      const reportContainer = document.getElementById("reportContainer");

      try {
        loader.style.display = "flex";
        reportContainer.style.display = "none";

        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            action: "getVisitReport",
            school: schoolName,
            visit: visitNumber
          })
        });

        const result = await res.json();
        if (result.success) {
          const report = result.data;
          for (const key in report) {
            const el = document.getElementById(key);
            if (el) el.textContent = report[key] || "-";
          }
          loader.style.display = "none";
          reportContainer.style.display = "block";
        } else {
          loader.style.display = "none";
          alert("⚠️ " + (result.message || "لم يتم العثور على التقرير"));
        }
      } catch (err) {
        loader.style.display = "none";
        console.error("خطأ:", err);
        alert("❌ فشل الاتصال بالخادم");
      }
    }

    loadReport();
  </script>
</body>
</html>
