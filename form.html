<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ูุธุงู ุชูููู ุงููุจุงูู ุงููุฏุฑุณูุฉ</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: "Tajawal", sans-serif;
      margin: 0;
      background: #f5f7fa;
    }

    .filters {
      background: #f9fbfd;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .filters h2 {
      margin-bottom: 15px;
      color: #13344f;
      text-align: center;
    }
    .filters label {
      display: block;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .filters select,
    .filters input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }

    #evaluationForm {
      display: none;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-navigation {
      text-align: center;
      margin-top: 20px;
    }
    .form-navigation button {
      margin: 5px;
      padding: 10px 25px;
      background: #13344f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    .form-navigation button:hover {
      background: #0e2233;
    }

    header, footer {
      background: #13344f;
      color: white;
      text-align: center;
      padding: 15px 0;
    }

    header img.logo {
      height: 50px;
      display: block;
      margin: 0 auto 10px;
    }

    footer {
      font-size: 14px;
    }
  </style>
  
</head>
<body>

  <!-- โ ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู -->
  <script>
    let data = []; // ูุฎุฒู ููู ุจูุงูุงุช ุงููุฏุงุฑุณ
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "index.html";
    }
  </script>

  <!-- ุงูููุฏุฑ -->
  <header class="main-header">
    <img src="logo.png" alt="ุดุนุงุฑ ุดุฑูุฉ ุณูุงูุง" class="logo">
    <h1>ุดุฑููููุฉ ุณูุงูุง</h1>
    <h2 class="subtitle">ูุธุงู ุชูููู ุงููุจุงูู ุงููุฏุฑุณูุฉ</h2>
  </header>

  <main class="container">

    <!-- ูุณู ุงูููุงุชุฑ -->
    <section class="filters">
      <h2>ุงุฎุชูุงุฑ ุงููุฏุฑุณุฉ</h2>

      <label>ุงูููุทูุฉ:
        <select id="regionFilter">
          <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
        </select>
      </label>

      <label>ุงููุฏููุฉ:
        <select id="cityFilter" disabled>
          <option value="">ุงุฎุชุฑ ุงููุฏููุฉ</option>
        </select>
      </label>

      <label>ุงููุฏุฑุณุฉ:
        <input type="text" id="schoolSearch" placeholder="๐ ุงุจุญุซ ุนู ูุฏุฑุณุฉ">
        <select id="schoolFilter" disabled>
          <option value="">ุงุฎุชุฑ ุงููุฏุฑุณุฉ</option>
        </select>
      </label>
    </section>

    <!-- ุดุฑูุท ุงูุชูุฏู -->
    <div id="progress-bar">
      <div id="progress"></div>
    </div>
    <!-- โ ูุนูููุงุช ุขุฎุฑ ุฒูุงุฑุฉ -->
<div id="lastVisitInfo" 
     style="display:none; text-align:center; margin:15px 0; font-weight:bold; color:#13344f; background:#f0f4f8; padding:10px; border-radius:6px;">
</div>
    <!-- ุงูููุงุฐุฌ -->
    <form id="evaluationForm" novalidate>

      <!-- ุงููุณู ุงูุฃูู -->
<div class="form-step active">
  <h2>ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h2>
  <div class="form-grid">
    <label>ุชุงุฑูุฎ ุงูุฒูุงุฑุฉ:
      <input type="date" id="visit_date" name="visit_date" required>
    </label>
    <input type="hidden" id="visit_day" name="visit_day">
    <input type="hidden" id="visit_month" name="visit_month">
    <input type="hidden" id="visit_year" name="visit_year">

    <label>ุงููุดุฑู ุงูุฒุงุฆุฑ:
      <input type="text" name="visitor" id="visitor" readonly>
    </label>
    <label>ุงูููุทูุฉ: <input type="text" name="region" id="region" readonly></label>
    <label>ุงููุฏููุฉ: <input type="text" name="city" id="city" readonly></label>
    <label>ุงุณู ุงููุฏุฑุณุฉ: <input type="text" name="school" id="school" readonly></label>

    <label>ุงูุฑูู ุงููุฒุงุฑู: 
      <input type="text" name="code" id="code" required>
    </label>
    <label>ุงุณู ุงูุญู/ุงูุดุงุฑุน: 
      <input type="text" name="street" id="street">
    </label>
    <label>ุชุตููู ุงููุฏุฑุณุฉ: 
      <input type="text" name="category" id="category">
    </label>
    <label>ุงููุฑุญูุฉ ุงูุชุนููููุฉ: 
      <input type="text" name="stage" id="stage">
    </label>
    <label>ุงููุฑุงุญู ุงูููุญูุฉ: 
      <input type="text" name="extra_stages" id="extra_stages">
    </label>
    <label>ุชุงุฑูุฎ ุงููุญุต: 
      <input type="date" name="inspection_date" id="inspection_date">
    </label>
    <label>ุนุฏุฏ ุงููุตูู: 
      <input type="number" name="classes" id="classes">
    </label>
    <label>ุดุจูุฉ ุงูููุงู ุชุตู ูููุฏุฑุณุฉ:
      <select name="water" id="water">
        <option>ูุนู</option>
        <option>ูุง</option>
      </select>
    </label>
    <label>ุดุจูุฉ ุงูุตุฑู ุงูุตุญู ุชุตู ูููุฏุฑุณุฉ:
      <select name="sewage" id="sewage">
        <option>ูุนู</option>
        <option>ูุง</option>
      </select>
    </label>
    <label>ุทุฑู ุงููุตูู ูููุฏุฑุณุฉ: 
      <input type="text" name="access" id="access">
    </label>
    <label>ููููุฉ ุงููุจูู: 
      <input type="text" name="ownership" id="ownership">
    </label>
  </div>
  <div class="form-navigation">
    <button type="button" class="next">ุงูุชุงูู</button>
  </div>
</div>

<!-- โ ุตูุฏูู ุงูุฑุณุงูุฉ (ุฃุถูู ููุง ูุจู ุงููุณู ุงูุซุงูู ุฃู ุจุนุฏู) -->
  <div id="formMessage" 
       style="display:none; color:red; font-weight:bold; text-align:center; margin:15px 0;">
  </div>

      <!-- ุงููุณู ุงูุซุงูู -->
<div class="form-step">
  <h2>ุงูุตุญุฉ ูุงูุณูุงูุฉ</h2>
  <div class="form-grid">
    <label>ูุฎุงุฑุฌ ุงูุทูุงุฑุฆ:
      <select name="emergency_exits" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ูุถุฎุงุช ุงูุญุฑูู:
      <select name="fire_pumps" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุจูุฑุงุช ุฎุฑุทูู ุงูุญุฑูู:
      <select name="fire_hose_reels" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุทูุงูุงุช ุงูุญุฑูู:
      <select name="fire_extinguishers" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ููุญุฉ ุชุญูู:
      <select name="control_panel" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ููุงุดู ุฅูุฐุงุฑ ุงูุญุฑูู:
      <select name="smoke_detectors" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุฌุฑุณ ุงูุฐุงุฑ:
      <select name="fire_alarm" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุญูุงุฌุฒ ุงูุณูุงูุฉ:
      <select name="safety_barriers" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ููุญุงุช ูุฎุงุฑุฌ ุงูุทูุงุฑุฆ:
      <select name="exit_signs" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุตูุงุฏูู ุงูุฅุณุนุงูุงุช ุงูุฃูููุฉ:
      <select name="first_aid" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ููุงุท ุงูุชุฌูุน ูููุญุงุชูุง:
      <select name="assembly_points" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุงูุญูุงู ุงูููุดููุฉ:
      <select name="edges" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ูุซุงุฆู ุงูุณูุงูุฉ:
      <select name="safety_docs" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ูุตูุฉ ุงูุฏูุงุน ุงููุฏูู:
      <select name="civil_defense" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>

    <label>ุงูุฃุจูุงุจ ูุงูููุงุชูุญ:
      <select name="keys" required>
        <option value="">ุงุฎุชุฑ</option>
        <option value="ูุทุงุจู">ูุทุงุจู</option>
        <option value="ุบูุฑ ูุทุงุจู">ุบูุฑ ูุทุงุจู</option>
        <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
      </select>
    </label>
  </div>

  <div class="form-navigation">
    <button type="button" class="prev">ุงูุณุงุจู</button>
    <button type="button" class="next">ุงูุชุงูู</button>
  </div>
</div>


      <!-- ุงููุณู ุงูุซุงูุซ -->
      <div class="form-step">
        <h2>ุงูุนูุงุตุฑ ุงููุฏููุฉ</h2>
        <div class="form-grid">
          <label>ุญุงูุฉ ุงูุญูุงุฆุท: <input type="text" name="walls_condition"></label>
          <label>ุงูุณูุงูู ูุนูุงุตุฑูุง: <input type="text" name="stairs"></label>
          <label>ุงูููุงูุฐ: <input type="text" name="windows"></label>
          <label>ุงูุฃุจูุงุจ: <input type="text" name="doors"></label>
          <label>ุญุงูุฉ ุงูุฃุฑุถูุงุช: <input type="text" name="floors_condition"></label>
          <label>ุงูููุงูุฑ: <input type="text" name="light_wells"></label>
          <label>ุนุฒู ุงูุณุทุญ: <input type="text" name="roof_insulation"></label>
          <label>ุชุตุฑูู ุงูุณุทุญ: <input type="text" name="roof_drainage"></label>
          <label>ุฅุทุงุฑ ุงูุณุทุญ / ุงูุญูุงุฌุฒ: <input type="text" name="roof_frame"></label>
          <label>ููุญุฏุฑ ุฐูู ุงูุงุญุชูุงุฌุงุช ุงูุฎุงุตุฉ: <input type="text" name="accessibility_ramp"></label>
          <label>ุงูุญุงูุฉ ุงูุนุงูุฉ ููููุงุทู ุงูุฎุงุฑุฌูุฉ ูุงูุทุฑู: <input type="text" name="external_condition"></label>
          <label>ุงูุจูุงุจุงุช ุงูุฑุฆูุณูุฉ: <input type="text" name="main_gates"></label>
          <label>ุงูุณูุฑ: <input type="text" name="fence"></label>
          <label>ุงูุนูุงุตุฑ ุงููููุงููููุฉ: <input type="text" name="mechanical"></label>
          <label>ููุญุฉ ุงูุชูุฒูุน: <input type="text" name="distribution"></label>
          <label>ูุธุงู ุงูุชุฃุฑูุถ: <input type="text" name="earthing"></label>
          <label>ุฃูุธูุฉ ุงูุณูุงุนุงุช ูุงูุตูุช: <input type="text" name="sound"></label>
          <label>ุญุงูุฉ ุงูุฅุถุงุกุฉ ุงูุนุงูุฉ: <input type="text" name="lighting"></label>
          <label>ุฅุถุงุกุฉ ุงูุทูุงุฑุฆ: <input type="text" name="emergency_lighting"></label>
          <label>ุงูููุงุจุณ ููููุงุช ุงูุชูุฏูุฏ: <input type="text" name="sockets"></label>
          <label>ููููุงุช ุงูููุงุก: <input type="text" name="ac"></label>
          <label>ุงููุถุฎุงุช: <input type="text" name="pumps"></label>
          <label>ูุฑุงูุญ ุงูุดูุท: <input type="text" name="fans"></label>
          <label>ุงููุตุงุนุฏ: <input type="text" name="elevators"></label>
          <label>ุณุฎุงูุงุช ุงูููุงู: <input type="text" name="heaters"></label>
          <label>ุฎุฒุงูุงุช ุงูููุงู ุงูุฃุฑุถูุฉ: <input type="text" name="tank_ground"></label>
          <label>ุฎุฒุงูุงุช ุงูููุงู ุงูุนูููุฉ: <input type="text" name="tank_top"></label>
          <label>ุงูุญูุงุฌุฒ ูุงูุงุถุงูุงุช ุงูุนุดูุงุฆูุฉ: <input type="text" name="barriers"></label>
          <label>ุงูุชูุตููุงุช ุงูููุฑุจุงุฆูุฉ ุงูุนุดูุงุฆูุฉ: <input type="text" name="wiring"></label>
        </div>
        <div class="form-navigation">
          <button type="button" class="prev">ุงูุณุงุจู</button>
          <button type="submit">ุฅุฑุณุงู</button>
        </div>
      </div>
    </form>

    <!-- ุฃุฒุฑุงุฑ ุฅุถุงููุฉ -->
    <div class="form-navigation">
      <button type="button" id="newEntryBtn">๐ ุฅุฏุฎุงู ุฌุฏูุฏ</button>
      <button type="button" id="logoutBtn">๐ช ุฎุฑูุฌ</button>
    </div>
  </main>

  <!-- ุงูููุชุฑ -->
  <footer class="main-footer">
    <p>ุฌููุน ุงูุญููู ูุญููุธุฉ ูุดุฑูุฉ ุณูุงูุง ยฉ 2025</p>
  </footer>

  <script>
     let data = []; // โ ุชุนุฑูู ุงููุชุบูุฑ ูู ุงูุจุฏุงูุฉ
     async function loadSchools() {
  try {
    const res = await fetch(API_URL);
    data = await res.json(); 
    console.log("๐ฆ ุชู ุฌูุจ ุงููุฏุงุฑุณ:", data);

    // ๐ข ููุก ุงูููุงุชุฑ (ุงูููุทูุฉ)
    const regionSelect = document.getElementById("regionFilter");
    const citySelect = document.getElementById("cityFilter");
    const schoolSelect = document.getElementById("schoolSelect");

    // ุชูุฑูุบ ุงููุฏูู
    regionSelect.innerHTML = "<option disabled selected>ุงุฎุชุฑ ุงูููุทูุฉ</option>";
    citySelect.innerHTML = "<option disabled selected>ุงุฎุชุฑ ุงููุฏููุฉ</option>";
    schoolSelect.innerHTML = "<option disabled selected>ุงุฎุชุฑ ุงููุฏุฑุณุฉ</option>";

    // ููุก ุงูููุงุทู ุจุฏูู ุชูุฑุงุฑ
    const regions = [...new Set(data.map(s => s.region))];
    regions.forEach(r => {
      let opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r;
      regionSelect.appendChild(opt);
    });

    // ๐ข ุนูุฏ ุงุฎุชูุงุฑ ููุทูุฉ โ ูููุฃ ุงููุฏู
    regionSelect.addEventListener("change", () => {
      const selectedRegion = regionSelect.value;
      const cities = [...new Set(data.filter(s => s.region === selectedRegion).map(s => s.city))];

      citySelect.innerHTML = "<option disabled selected>ุงุฎุชุฑ ุงููุฏููุฉ</option>";
      schoolSelect.innerHTML = "<option disabled selected>ุงุฎุชุฑ ุงููุฏุฑุณุฉ</option>";

      cities.forEach(c => {
        let opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        citySelect.appendChild(opt);
      });
    });

    // ๐ข ุนูุฏ ุงุฎุชูุงุฑ ูุฏููุฉ โ ูููุฃ ุงููุฏุงุฑุณ
    citySelect.addEventListener("change", () => {
      const selectedRegion = regionSelect.value;
      const selectedCity = citySelect.value;
      const schools = data.filter(s => s.region === selectedRegion && s.city === selectedCity);

      schoolSelect.innerHTML = "<option disabled selected>ุงุฎุชุฑ ุงููุฏุฑุณุฉ</option>";
      schools.forEach(sc => {
        let opt = document.createElement("option");
        opt.value = sc.school;
        opt.textContent = sc.school;
        schoolSelect.appendChild(opt);
      });
    });

  } catch (err) {
    console.error("โ ุฎุทุฃ ูู ุชุญููู ุงููุฏุงุฑุณ:", err);
  }
}


// ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
loadSchools();

    const API_URL = "/api";

    // ุงุณุชุฎุฑุงุฌ ุงูููู/ุงูุดูุฑ/ุงูุณูุฉ ูู ุงูุชุงุฑูุฎ
    document.getElementById("visit_date").addEventListener("change", function() {
      const date = new Date(this.value);
      const days = ["ุงูุฃุญุฏ","ุงูุฅุซููู","ุงูุซูุงุซุงุก","ุงูุฃุฑุจุนุงุก","ุงูุฎููุณ","ุงูุฌูุนุฉ","ุงูุณุจุช"];
      document.getElementById("visit_day").value = days[date.getDay()];
      document.getElementById("visit_month").value = (date.getMonth() + 1).toString().padStart(2, "0");
      document.getElementById("visit_year").value = date.getFullYear();
    });

    document.addEventListener("DOMContentLoaded", async () => {
      // ุชุญููู ุงุณู ุงููุดุฑู
      document.getElementById("visitor").value = localStorage.getItem("fullName") || "ูุดุฑู";

      // ุฒุฑ ุงูุฎุฑูุฌ
      document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.clear();
        window.location.href = "index.html";
      });

      // ุฒุฑ ุฅุฏุฎุงู ุฌุฏูุฏ
      document.getElementById("newEntryBtn").addEventListener("click", () => {
        document.getElementById("evaluationForm").reset();
        document.getElementById("evaluationForm").style.display = "none";
      });

      // โ ุฌูุจ ุจูุงูุงุช ุงููุฏุงุฑุณ
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        const regionSelect = document.getElementById("regionFilter");
        const citySelect = document.getElementById("cityFilter");
        const schoolSelect = document.getElementById("schoolFilter");

        // ุชุนุจุฆุฉ ุงูููุงุทู
        const regions = [...new Set(data.map(s => s.region))];
        regions.forEach(r => {
          const opt = document.createElement("option");
          opt.value = r;
          opt.textContent = r;
          regionSelect.appendChild(opt);
        });

        // ุนูุฏ ุงุฎุชูุงุฑ ููุทูุฉ
        regionSelect.addEventListener("change", () => {
          const cities = [...new Set(data.filter(s => s.region === regionSelect.value).map(s => s.city))];
          citySelect.innerHTML = "<option value=''>ุงุฎุชุฑ ุงููุฏููุฉ</option>";
          citySelect.disabled = false;
          cities.forEach(c => {
            const opt = document.createElement("option");
            opt.value = c;
            opt.textContent = c;
            citySelect.appendChild(opt);
          });
        });

        // ุนูุฏ ุงุฎุชูุงุฑ ูุฏููุฉ
        citySelect.addEventListener("change", () => {
          const schools = data.filter(s => s.city === citySelect.value);
          schoolSelect.innerHTML = "<option value=''>ุงุฎุชุฑ ุงููุฏุฑุณุฉ</option>";
          schoolSelect.disabled = false;
          schools.forEach(s => {
            const opt = document.createElement("option");
            opt.value = s.school;
            opt.textContent = s.school;
            schoolSelect.appendChild(opt);
          });
        });

        // ๐ข ุนูุฏ ุงุฎุชูุงุฑ ูุฏุฑุณุฉ
schoolSelect.addEventListener("change", () => {
  const selectedSchool = schoolSelect.value;
  const schoolData = data.find(s => s.school === selectedSchool);

  if (schoolData) {
    document.getElementById("region").value = schoolData.region;
    document.getElementById("city").value = schoolData.city;
    document.getElementById("school").value = schoolData.school;
    document.getElementById("code").value = schoolData.code;

    // โ ุนุฑุถ ุขุฎุฑ ุฒูุงุฑุฉ ูุนุฏุฏ ุงูุฒูุงุฑุงุช
    const infoBox = document.getElementById("lastVisitInfo");
    infoBox.innerHTML = `
      ๐ ุขุฎุฑ ุฒูุงุฑุฉ: <b>${schoolData.last_visit || "ูุง ููุฌุฏ"}</b> |
      ๐ข ุนุฏุฏ ุงูุฒูุงุฑุงุช: <b>${schoolData.visits || 0}</b>
    `;
    infoBox.style.display = "block";
  } else {
    document.getElementById("lastVisitInfo").innerHTML =
      "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ููุฐู ุงููุฏุฑุณุฉ";
  }

  document.getElementById("evaluationForm").style.display = "block";
});

  // โ ุฌูุจ ุขุฎุฑ ุฒูุงุฑุฉ ูู ุงูุณูุฑุจุช
  try {
    console.log("๐ ุจุฏุก ุทูุจ ุขุฎุฑ ุฒูุงุฑุฉ ูููุฏุฑุณุฉ:", schoolData.school);
    const res = await fetch(API_URL + "?school=" + encodeURIComponent(schoolData.school));
    console.log("๐ ุงูุฑุงุจุท ุงููุณุชุฎุฏู:", API_URL + "?school=" + encodeURIComponent(schoolData.school));

    const result = await res.json();
    console.log("๐ฆ ุงูุฑุฏ ุงููุงุฏู ูู ุงูุณูุฑุจุช:", result);

    const infoBox = document.getElementById("lastVisitInfo");

    if (result && result.success) {
      console.log("โ ุชู ุงูุนุซูุฑ ุนูู ุฒูุงุฑุฉ ุณุงุจูุฉ");

      const visitId = result.visit_id;       // ุฑูู ุงูุฒูุงุฑุฉ
      const visitDate = new Date(result.visit_date); // ุชุญููู ุงููุต ุฅูู ุชุงุฑูุฎ
      const formattedDate = visitDate.toLocaleDateString("ar-EG", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit"
      });

      infoBox.innerHTML = `๐ ุชุงุฑูุฎ ุขุฎุฑ ุฒูุงุฑุฉ: <b>${formattedDate}</b> | ๐ข ุฑูู ุงูุฒูุงุฑุฉ: <b>${visitId}</b>`;
      infoBox.style.display = "block";
    } else {
      console.warn("โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุฒูุงุฑุฉ ุณุงุจูุฉ");
      infoBox.innerHTML = "โ๏ธ ูุง ููุฌุฏ ุฒูุงุฑุฉ ุณุงุจูุฉ ููุฐู ุงููุฏุฑุณุฉ";
      infoBox.style.display = "block";
    }
  } catch (err) {
    console.error("โ ุฎุทุฃ ูู ุฌูุจ ุขุฎุฑ ุฒูุงุฑุฉ:", err);
  }
});



      } catch (err) {
        console.error("ุฎุทุฃ ูู ุชุญููู ุงููุฏุงุฑุณ:", err);
        alert("โ๏ธ ูู ูุชู ุชุญููู ุจูุงูุงุช ุงููุฏุงุฑุณ ูู ุงูุดูุช");
      }
    });
    // โ ุงูุชุญูู ูู ุงูุฎุทูุงุช (ุงูุชุงูู/ุงูุณุงุจู)
document.addEventListener("DOMContentLoaded", () => {
  const steps = document.querySelectorAll(".form-step");
  const nextBtns = document.querySelectorAll(".next");
  const prevBtns = document.querySelectorAll(".prev");
  let currentStep = 0;

  function showStep(index) {
    steps.forEach((step, i) => {
      step.style.display = i === index ? "block" : "none";
    });
  }

  showStep(currentStep);

  nextBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep(currentStep);
      }
    });
  });

  prevBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
      }
    });
  });
});
// โ ุฅุฑุณุงู ุงููููุฐุฌ ุฅูู Google Sheet
document.getElementById("evaluationForm").addEventListener("submit", async (e) => {
  e.preventDefault(); // ููุน ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ

  const form = e.target;
  const messageBox = document.getElementById("formMessage");

  // โ ุงูุชุญูู ูู ุงูุญููู ุงููุทููุจุฉ
  const requiredFields = form.querySelectorAll("[required]");
  let missing = [];

  requiredFields.forEach(field => {
    if (!field.value || field.value.trim() === "") {
      missing.push(field);
      field.style.border = "2px solid red"; // ุชูููุฒ ุงูุญููู ุงููุงูุตุฉ
    } else {
      field.style.border = ""; // ุฅุฒุงูุฉ ุงูุชูููุฒ ุฅุฐุง ุงูุชูุฃ
    }
  });

  if (missing.length > 0) {
    messageBox.textContent = "โ๏ธ ุนููู ุฅููุงู ุจุงูู ุงูุญููู ุงููุทููุจุฉ";
    messageBox.style.display = "block";
    return; // ุฅููุงู ุงูุฅุฑุณุงู
  } else {
    messageBox.style.display = "none"; // ุฅุฎูุงุก ุงูุฑุณุงูุฉ ุฅุฐุง ูู ุดูุก ุชูุงู
  }

  // โ ุฅุฐุง ุฌููุน ุงูุญููู ููุชูุฆุฉ โ ุชุฌููุฒ ุงูุจูุงูุงุช
  const formData = new FormData(form);
  const data = {};
  formData.forEach((value, key) => {
    data[key] = value;
  });

  try {
    const res = await fetch(API_URL, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    action: "saveEvaluation",   // โ ูุชูุงูู ูุน ุงูุณูุฑุจุช
    ...data                     // โ ุฅุฑุณุงู ุงูููู ูุจุงุดุฑุฉ ุจุฏูู payload
  })
});



    if (!res.ok) throw new Error("ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู");

    const result = await res.json();

    if (result.success) {
      alert("โ ุชู ุฅุฑุณุงู ุงูุชูููู ุจูุฌุงุญ!");
      form.reset();
      document.getElementById("evaluationForm").style.display = "none";
    } else {
      alert("โ๏ธ ูู ูุชู ุงูุฅุฑุณุงู: " + (result.message || "ุฎุทุฃ ุบูุฑ ูุนุฑูู"));
    }
  } catch (err) {
    console.error("ุฎุทุฃ:", err);
    alert("โ ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู");
  }
});
// โ ุชุนุฑูู ุนูุงุตุฑ HTML
const schoolSelect = document.getElementById("schoolFilter");
const infoBox = document.getElementById("lastVisitInfo");

// โ ุนูุฏ ุงุฎุชูุงุฑ ูุฏุฑุณุฉ ูู ุงููุงุฆูุฉ
schoolSelect.addEventListener("change", () => {
  const selectedSchool = schoolSelect.value;
  const schoolInfo = data.find(s => s.school === selectedSchool);

  if (schoolInfo) {
    infoBox.innerHTML = `
      ๐๏ธ ุขุฎุฑ ุฒูุงุฑุฉ: <b>${schoolInfo.last_visit || "ูุง ููุฌุฏ"}</b> |
      ๐ข ุนุฏุฏ ุงูุฒูุงุฑุงุช: <b>${schoolInfo.visits || 0}</b>
    `;
    infoBox.style.display = "block";
  } else {
    infoBox.innerHTML = "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ููุฐู ุงููุฏุฑุณุฉ";
    infoBox.style.display = "block";
  }
});
  </script>
  
</body>
</html>
